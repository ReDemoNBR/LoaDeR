<script>
//AlterOnLoad();
//var GameWindow;
var SyncWindow;

function AlterOnLoad(){
  //SyncWindow = window.opener.SyncWindow;
  PingController();
}


function PingController(){
  console.log("sending message: Opening");
  SyncWindow.postMessage("Opening", "https://n-td7fejzwmlqmheejrvhujrb7m4phyvsuihj5jqq-script.googleusercontent.com");
}


function Console(){
  console.log("AutoMessage Hello!");
}


function ReceiveMessage(e){
  var origin = e.origin || e.originalEvent.origin;
  console.log("Message received from: "+origin);
  //if(origin !== "https://script.google.com/macros/s/AKfycby5U_ZWMloL8YBFliDWvAg6qbjcGSbCq1vn3G1BPNmo/dev"){
  if(origin !== "https://n-td7fejzwmlqmheejrvhujrb7m4phyvsuihj5jqq-script.googleusercontent.com"){
    console.log("Untrusted source... Message ignored");
    return;
  }
  if(e.data.Message == "SyncWindow"){
    Logger.log(e.data.Message);
    SyncWindow = JSON.parse(ab2str(e.data.Content));
    return AlterOnLoad();
  }
  var message = e.data;
  console.log("Message content: "+message);
  if(message == "Close"){
    CloseOpener();
    window.close();
  }
  if(message.indexOf("Launch ") == 0){
    document.write(message.replace("Launch "));
    var obj = document.getElementById("HGTestVersion");
    obj.width = window.innerWidth;
    obj.height = window.innerHeight;
  }
}


function CloseOpener(){
  window.opener.postMessage("Close", "https://n-td7fejzwmlqmheejrvhujrb7m4phyvsuihj5jqq-script.googleusercontent.com");
}


window.addEventListener("message", ReceiveMessage, false);


function ab2str(buf) {
  return String.fromCharCode.apply(null, new Uint16Array(buf));
}
</script>
